#!/usr/bin/env ruby

require 'bosh_manifest_generator'

if ARGV.length < 2
  puts 'Usage: bundle exec ruby generate_file '\
  '<passwords_template> <out_file>'
  exit 1
end

@prefix = ENV['VAULT_PREFIX']
if !@prefix || @prefix.empty?
  puts 'VAUTL_PREFIX not set'
  exit 1
end

@passwords_template = ARGV[0]
@out_file = ARGV[1]

generator = BoshManifestGenerator::ManifestGenerator
            .new(nil,
                 vault_prefix:
                  "secret/bosh/#{@deployment_name}/#{@environment}")

generator.render(@passwords_template, @out_file)
